#!/usr/bin/perl
use strict;
use Carp;
# pnfo
# NFO files are ASCII-art with the cp437 codepage
# Lucida ConsoleP has support for all the cp437 chars

my $term = "urxvt -fn xft:'Lucida ConsoleP:pixelsize=10:antialias=0' -fg '#ffffff' -uc +sb";
my $viewer = "vimpager-nfo";

my @nfos;

# view all nfos in ./ if no arg is supplied
if(!@ARGV) {
  @nfos = grep{/\.nfo$/} glob("./*");
  if(!@nfos) {
    print "No NFO files found in ./\n";
    exit 1;
  }
  view(@nfos);
  exit 0;
}
# if there's a second arg, the user is using globbing
if($ARGV[1]) {
  print "",$_,"\n" for @ARGV;
  view(@ARGV);
  exit 0;
}

# single file
if(-f $ARGV[0] and $ARGV[0] =~ /\.nfo$/) {
  view($ARGV[0]);
  exit 0;
}

# traverse the directory specified
if(-d $ARGV[0]) {
  @nfos = grep{/\.nfo$/} glob("$ARGV[0]/*");
  if(!@nfos) {
    print "No NFO files found in $ARGV[0]\n";
    exit 1;
  }
  view(@nfos);
}

sub view {
  my @files = @_;
  for my $file(@files) {
    system("$term -e $viewer \"$file\"") == 0 or croak();
  }
}


